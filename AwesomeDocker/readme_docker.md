
# Общее

Docker - инструмент создания виртуальных систем, внутри которых будет запускаться код

По сути поднимает полноценную виртуальную систему

Использования докера можно разделить на 3 части :  
1) Написание инструкций
1) Создание образа
2) Запуск контейнера

**dockerfile (инструкция)** - Инструкция для создания образа, то есть набор параметров и описания, которые позволяют создать конкретный образ с конкретным наполнением

**Образ (Image)** - это созданный и сохраненный образ какого то виртуального окружения. То есть как DVD диск с игрой

**Контейнер** - это запущенный образ, как только он поднимается (запускается) - происходит исполнение инструкций/скриптов которые в нем записаны

----
## Пример  

Нам нужно запустить скрипт питона который бы принтил `hello world`  
У нас есть : `скрипт hello_world.py`   
1) В рамках *инструкции* мы описываем:  
+ Нам нужно установить linux
+ Нам нужно установить python
+ Нам нужно скопировать hello_world.py внутрь образа
+ Нам нужно запустить hello_world.py при запуске контейнера
2) В рамках создания *образа* мы сохраняем систему, описанную в dockerfile
+ Получаем болванку которая пока что ничего не делает
+ Эту болванку можно передвать кому угодно
+ Эта болванка будет запускаться у всех одинаково
3) В рамках запуска болванки - получаем *контейнер*
+ Запускается виртуальная машина (контейнер)
+ Запускается скрипт внутри нее
+ Если не указано иное - VM умирает


По сути запуск контейнера == запуск скрипта



# dockerfile
Инструкция по созданию образа

Результат запуска dockerfile - образ с параметрами указанными в файле.


Основные параметры:
1) **FROM**
    + Образ на основе которого будет система  
    + Как будто устанавливаем систему на пк
    + Все образы храняться либо в общем базе https://hub.docker.com/
    + Либо в закрытом персональном сервере 
    + Образ может быть как голым, так и с предустановленными вещами
```docker
FROM ubuntu # пустой образ
```
```docker
FROM python:3.10-slim # образ с предустановленным питоном и другими зависимостями
```
```docker
FROM nlp_pytorch_DL_ML_crypto_flex # можно делать готовые образы с кучей ништяков под себя
```
2) **ENV**
    + Передаем глобальные переменные которые будут сразу в системе
    + Можно прописать логины\пароли чтобы в коде они были не в явном виде
```docker 
ENV LOGIN=BIG
ENV PASSWORD=BOII
```
3) **COPY | ADD**
    + **ADD** умеет в скачивание файлов с урла
    + **COPY** копирует только с локальной машины
    + Команда копирования необходимых файлов внутрь контейнера
    + По дефолту контейнер пустой
    + Через это команду мы выбираем какие конкретные файлы попадут внутрь нашего корабля
    + Обычно это пачка кода или проект

```docker
#команда | что забираем | куда кладем
COPY /my_awesome_code /home

```
4) **RUN**
    + Команды которые выполняются при создании образа системы
    + pip install
    + apt update
    + apt install
    + какие то общие настройки системы
```docker
RUN apt update

RUN pip install pandas
```
5) **CMD**
    + Команды которые будут запущены после успешного поднятия контейнера

```docker
CMD ["/bin/bash","-c","python3 hello_world.py]

```

В итоге имеем :

```docker
FROM python:3.10-slim

ENV LOGIN=BIG
ENV PASSWORD=BOII

RUN apt update
RUN pip install pandas
# До этого момента создается контейнер
#Ниже уже идет событие при успешном запуске контейнера
CMD ["/bin/bash","-c","python3 hello_world.py]
```